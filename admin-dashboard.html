<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nova Admin Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ["Cairo", "sans-serif"] },
            colors: {
              dark: {
                900: "#0f172a", // Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                800: "#1e293b", // Ø®Ù„ÙÙŠØ© Ø§Ù„ÙƒØ±ÙˆØª ÙˆØ§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø±
                700: "#334155", // Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙˆØ§Ù„ÙÙˆØ§ØµÙ„
              },
              brand: { 500: "#3b82f6", 600: "#2563eb" }, // Ø£Ø²Ø±Ù‚ Ù†ÙŠÙˆÙ†
            },
          },
        },
      };
    </script>

    <style>
      body {
        background-color: #0f172a;
        color: #f1f5f9;
        font-family: "Cairo", sans-serif;
      }

      /* Tailwind apply aliases */
      .sidebar-link {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1rem;
        color: #9ca3af;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.875rem;
        font-weight: 700;
        border-radius: 0.75rem;
        margin-left: 0.5rem;
        margin-right: 0.5rem;
        margin-bottom: 0.25rem;
        position: relative;
        overflow: hidden;
        border: 1px solid transparent;
      }
      .sidebar-link:hover {
        background-color: #1e293b;
        color: white;
        transform: translateX(-4px);
        border-color: #334155;
      }
      .sidebar-link.active {
        background-color: #2563eb;
        color: white;
        box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3),
          0 4px 6px -4px rgba(59, 130, 246, 0.3);
        border-color: #3b82f6;
      }

      .submenu {
        margin-right: 1.5rem;
        margin-top: 0.25rem;
        padding-right: 0.75rem;
        border-right: 2px solid #334155;
        overflow: hidden;
        transition: all 0.5s;
        max-height: 0;
        opacity: 0;
      }
      .submenu.open {
        max-height: 24rem;
        opacity: 1;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
      }
      .submenu-link {
        display: block;
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        color: #9ca3af;
        border-radius: 0.5rem;
        transition: all;
        cursor: pointer;
      }
      .submenu-link:hover {
        color: white;
        background-color: #1e293b;
      }
      .submenu-link.active {
        color: #3b82f6;
        font-weight: 700;
        background-color: #1e293b;
      }

      .card {
        background-color: #1e293b;
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -4px rgba(0, 0, 0, 0.1);
        border: 1px solid #334155;
        transition: all 0.3s;
      }
      .input-std {
        width: 100%;
        background-color: #0f172a;
        border: 1px solid #334155;
        color: white;
        border-radius: 0.75rem;
        padding: 0.75rem;
        font-size: 0.875rem;
        outline: none;
        transition: all;
        box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
      }
      .input-std:focus {
        ring: 2px;
        ring-color: #3b82f6;
        border-color: #3b82f6;
      }
      .btn-primary {
        background-color: #2563eb;
        color: white;
        padding-left: 1.5rem;
        padding-right: 1.5rem;
        padding-top: 0.625rem;
        padding-bottom: 0.625rem;
        border-radius: 0.75rem;
        font-weight: 700;
        box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
        transition: all;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }
      .btn-primary:hover {
        background-color: #3b82f6;
        transform: translateY(-2px);
      }
      .btn-primary:active {
        transform: scale(0.95);
      }

      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #0f172a;
      }
      ::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 10px;
      }

      .fade-enter-active,
      .fade-leave-active {
        transition: opacity 0.3s ease;
      }
      .fade-enter-from,
      .fade-leave-to {
        opacity: 0;
      }
    </style>
  </head>
  <body class="antialiased">
    <div id="app" class="flex h-screen overflow-hidden">
      <div
        v-if="!currentUser"
        class="absolute inset-0 z-50 min-h-screen flex items-center justify-center bg-dark-900 overflow-hidden">
        <div
          class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-brand-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>
        <div
          class="absolute bottom-[-20%] right-[-10%] w-96 h-96 bg-purple-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>

        <div
          class="card w-full max-w-md z-10 relative border border-dark-700/50 backdrop-blur-sm bg-dark-800/90">
          <div class="text-center mb-8">
            <div
              class="w-16 h-16 bg-brand-600 rounded-2xl flex items-center justify-center text-white font-black text-2xl mx-auto shadow-lg shadow-brand-500/40 mb-4">
              N
            </div>
            <h2 class="text-2xl font-bold text-white">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø¯ÙŠØ± ğŸ‘‹</h2>
            <p class="text-gray-400 text-sm mt-2">
              Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©
            </p>
          </div>

          <form @submit.prevent="login" class="space-y-5">
            <div>
              <label
                class="block text-xs font-bold text-gray-400 mb-2 uppercase"
                >Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label
              >
              <input
                v-model="authForm.email"
                type="email"
                class="input-std"
                placeholder="admin@nova.com"
                required />
            </div>
            <div>
              <label
                class="block text-xs font-bold text-gray-400 mb-2 uppercase"
                >ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label
              >
              <input
                v-model="authForm.password"
                type="password"
                class="input-std"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                required />
            </div>

            <div
              v-if="errorMsg"
              class="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-xs font-bold text-center">
              <i class="fa-solid fa-triangle-exclamation ml-1"></i> {{ errorMsg
              }}
            </div>

            <button type="submit" class="btn-primary w-full py-3 text-lg">
              <span v-if="!loading">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</span>
              <span v-else
                ><i class="fa-solid fa-circle-notch fa-spin"></i
              ></span>
            </button>
          </form>
          <p class="text-center text-xs text-gray-600 mt-6">
            Nova Admin System v3.1
          </p>
        </div>
      </div>

      <aside
        v-if="currentUser"
        class="w-72 bg-dark-900 border-l border-dark-700 flex-shrink-0 hidden md:flex flex-col z-30 shadow-xl relative">
        <div class="h-20 flex items-center px-6 border-b border-dark-700">
          <div
            class="w-10 h-10 bg-brand-600 rounded-xl flex items-center justify-center text-white font-black text-lg ml-3 shadow-lg shadow-brand-500/40">
            N
          </div>
          <div>
            <h1 class="text-xl font-black tracking-tight text-white">
              {{ settings.logoName || 'Ù…ØªØ¬Ø± Nova' }}
            </h1>
            <span
              class="text-[10px] font-bold text-gray-500 tracking-widest uppercase"
              >Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span
            >
          </div>
        </div>

        <nav
          class="flex-1 overflow-y-auto py-6 space-y-1 px-2 custom-scrollbar">
          <div v-if="currentUserVendors.length > 0" class="px-4 mb-4">
            <label class="block text-xs font-bold text-gray-400 mb-2 uppercase"
              >Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±</label
            >
            <select
              @change="setActiveVendor($event.target.value)"
              class="input-std !bg-dark-700">
              <option
                v-for="id in currentUserVendors"
                :key="id"
                :value="id"
                :selected="id === activeVendorId">
                {{ allVendors[id]?.store_info?.logoName || `Ù…ØªØ¬Ø± Ø±Ù‚Ù…:
                ${id.slice(0, 8)}` }}
              </option>
            </select>
            <p class="text-xs mt-2 text-gray-500">
              Ø¬Ø§Ø±ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø±:
              <span class="text-brand-500 font-bold"
                >{{ settings.logoName }}</span
              >
            </p>
          </div>
          <div
            class="px-4 mb-2 text-xs font-black text-gray-500 uppercase tracking-wider">
            Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </div>
          <div
            @click="navigateTo('dashboard')"
            :class="['sidebar-link', currentView === 'dashboard' ? 'active' : '']">
            <div class="flex items-center">
              <i class="fa-solid fa-chart-pie ml-3"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©
            </div>
          </div>

          <div>
            <div
              @click="toggleMenu('orders')"
              :class="['sidebar-link', isMenuOpen('orders') ? 'bg-dark-800 text-white' : '']">
              <div class="flex items-center">
                <i class="fa-solid fa-bag-shopping ml-3"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª
              </div>
              <i
                :class="['fa-solid fa-chevron-down text-[10px] transition-transform duration-300 opacity-50', menus.orders ? 'rotate-180' : '']"></i>
            </div>
            <div :class="['submenu', menus.orders ? 'open' : '']">
              <a
                @click="navigateTo('orders_manage')"
                :class="['submenu-link', currentView === 'orders_manage' ? 'active' : '']"
                >Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a
              >
              <a href="#" class="submenu-link">Ø·Ù„Ø¨Ø§Øª Ù…Ù‡Ù…Ù„Ø©</a>
            </div>
          </div>

          <div>
            <div
              @click="toggleMenu('products')"
              :class="['sidebar-link', isMenuOpen('products') ? 'bg-dark-800 text-white' : '']">
              <div class="flex items-center">
                <i class="fa-solid fa-box-open ml-3"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
              </div>
              <i
                :class="['fa-solid fa-chevron-down text-[10px] transition-transform duration-300 opacity-50', menus.products ? 'rotate-180' : '']"></i>
            </div>
            <div :class="['submenu', menus.products ? 'open' : '']">
              <a
                @click="navigateTo('products_manage')"
                :class="['submenu-link', currentView === 'products_manage' ? 'active' : '']"
                >Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a
              >
              <a href="#" class="submenu-link">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</a>
            </div>
          </div>

          <div
            class="px-4 mt-6 mb-2 text-xs font-black text-gray-500 uppercase tracking-wider">
            Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
          </div>

          <div>
            <div
              @click="toggleMenu('store')"
              :class="['sidebar-link', isMenuOpen('store') ? 'bg-dark-800 text-white' : '']">
              <div class="flex items-center">
                <i class="fa-solid fa-store ml-3"></i> Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
              </div>
              <i
                :class="['fa-solid fa-chevron-down text-[10px] transition-transform duration-300 opacity-50', menus.store ? 'rotate-180' : '']"></i>
            </div>
            <div :class="['submenu', menus.store ? 'open' : '']">
              <a
                @click="navigateTo('store_settings')"
                :class="['submenu-link', currentView === 'store_settings' ? 'active' : '']"
                >Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨</a
              >
              <a
                @click="navigateTo('store_policies')"
                :class="['submenu-link', currentView === 'store_policies' ? 'active' : '']"
                >Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª</a
              >
              <a
                :href="'storefront.html?vendorId=' + activeVendorId"
                target="_blank"
                v-if="activeVendorId"
                class="submenu-link text-green-400 font-bold mt-2">
                <i class="fa-solid fa-external-link-alt ml-1"></i> Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ØªØ¬Ø±
              </a>
            </div>
          </div>

          <div class="mt-8 pt-8 border-t border-dark-700">
            <div
              @click="logout"
              class="sidebar-link hover:bg-red-500/10 hover:text-red-500 hover:border-red-500/20">
              <div class="flex items-center">
                <i class="fa-solid fa-right-from-bracket ml-3"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
              </div>
            </div>
          </div>
        </nav>
      </aside>

      <main
        v-if="currentUser"
        class="flex-1 flex flex-col h-screen overflow-hidden bg-dark-900">
        <header
          class="bg-dark-800 h-20 border-b border-dark-700 flex items-center justify-between px-8 shadow-sm sticky top-0 z-20">
          <div class="flex items-center gap-4">
            <h2 class="text-xl font-bold text-white">{{ viewTitle }}</h2>
          </div>

          <div class="flex items-center space-x-4 space-x-reverse">
            <div class="text-left hidden sm:block">
              <p class="text-sm font-bold text-white">
                {{ currentUser.email }}
              </p>
              <span
                class="text-green-500 text-[10px] font-bold flex items-center justify-end gap-1"
                ><span
                  class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</span
              >
            </div>
            <div
              class="w-10 h-10 bg-brand-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg shadow-brand-500/30">
              {{ currentUser.email[0].toUpperCase() }}
            </div>
          </div>
        </header>

        <div class="flex-1 overflow-y-auto p-8 scroll-smooth">
          <div
            v-if="currentView === 'dashboard'"
            class="animate-fade space-y-6">
            <h1 class="text-2xl font-bold mb-6">Ù…Ù„Ø®Øµ Ù…ØªØ¬Ø±Ùƒ</h1>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="card relative overflow-hidden group">
                <div
                  class="absolute left-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition">
                  <i class="fa-solid fa-sack-dollar text-6xl text-white"></i>
                </div>
                <div class="flex justify-between items-start mb-4">
                  <div>
                    <p
                      class="text-xs font-bold text-gray-400 uppercase tracking-wider">
                      Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                    </p>
                    <h3 class="text-3xl font-black text-white mt-2">
                      {{ totalRevenue }}
                      <span class="text-sm text-gray-500 font-normal">EGP</span>
                    </h3>
                  </div>
                </div>
                <div class="w-full bg-dark-900 rounded-full h-1.5 mt-2">
                  <div
                    class="bg-brand-500 h-1.5 rounded-full"
                    style="width: 70%"></div>
                </div>
              </div>

              <div class="card relative overflow-hidden group">
                <div class="flex justify-between items-start mb-4">
                  <div>
                    <p
                      class="text-xs font-bold text-gray-400 uppercase tracking-wider">
                      Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                    </p>
                    <h3 class="text-3xl font-black text-white mt-2">
                      {{ Object.keys(orders).length }}
                    </h3>
                  </div>
                  <span
                    class="bg-dark-900 text-brand-500 text-xs px-2 py-1 rounded border border-dark-700"
                    >Ø¬Ø¯ÙŠØ¯: {{ pendingCount }}</span
                  >
                </div>
                <div class="w-full bg-dark-900 rounded-full h-1.5 mt-2">
                  <div
                    class="bg-purple-500 h-1.5 rounded-full"
                    style="width: 45%"></div>
                </div>
              </div>

              <div class="card relative overflow-hidden group">
                <div class="flex justify-between items-start mb-4">
                  <div>
                    <p
                      class="text-xs font-bold text-gray-400 uppercase tracking-wider">
                      Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                    </p>
                    <h3 class="text-3xl font-black text-white mt-2">
                      {{ Object.keys(products).length }}
                    </h3>
                  </div>
                </div>
                <div class="w-full bg-dark-900 rounded-full h-1.5 mt-2">
                  <div
                    class="bg-green-500 h-1.5 rounded-full"
                    style="width: 80%"></div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="flex justify-between items-center mb-6">
                <div>
                  <h3 class="font-bold text-lg text-white">Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                  <p class="text-sm text-gray-500">
                    Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø®Ù„Ø§Ù„ Ø§Ù„Ù€ 7 Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø®ÙŠØ±Ø©
                  </p>
                </div>
                <span
                  class="text-xs text-brand-500 bg-brand-500/10 px-3 py-1 rounded-full"
                  >ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ</span
                >
              </div>
              <div class="h-64 w-full">
                <canvas id="salesChart"></canvas>
              </div>
            </div>
          </div>

          <div v-if="currentView === 'products_manage'" class="animate-fade">
            <div class="flex justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
              <button
                @click="showAddProductModal = true; editingProduct = null; newProduct = {}"
                class="btn-primary">
                <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
              </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <div
                v-for="(prod, key) in products"
                :key="key"
                class="card !p-0 group relative overflow-hidden">
                <div class="h-48 bg-white p-4 flex items-center justify-center">
                  <img :src="prod.image" class="max-h-full object-contain" />
                </div>
                <div class="p-4 bg-dark-800">
                  <h3 class="font-bold text-white truncate">{{ prod.name }}</h3>
                  <div class="flex justify-between mt-2">
                    <span class="font-black text-brand-500"
                      >{{ prod.price }} EGP</span
                    >
                    <div class="space-x-3 space-x-reverse">
                      <button
                        @click="editProduct(key, prod)"
                        class="text-brand-500 hover:text-brand-400">
                        <i class="fa-solid fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                      </button>
                      <button
                        @click="deleteProduct(key)"
                        class="text-red-500 hover:text-red-400">
                        <i class="fa-solid fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div v-if="currentView === 'orders_manage'" class="animate-fade">
            <div class="flex justify-between mb-6">
              <h2 class="text-2xl font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
            </div>
            <div class="card overflow-hidden !p-0">
              <h3 class="text-center py-12 text-gray-500">
                Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...
              </h3>
            </div>
          </div>

          <div v-if="currentView === 'store_settings'" class="animate-fade">
            <div class="max-w-4xl mx-auto card">
              <h2
                class="text-xl font-bold mb-6 pb-4 border-b border-dark-700 text-white">
                Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
              </h2>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                  <label class="block text-xs font-bold text-gray-400 mb-2"
                    >Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± (Ø§Ù„Ù„ÙˆØ¬Ùˆ)</label
                  ><input v-model="settings.logoName" class="input-std" />
                </div>
                <div>
                  <label class="block text-xs font-bold text-gray-400 mb-2"
                    >Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ</label
                  ><input v-model="settings.topBarText" class="input-std" />
                </div>
                <div class="md:col-span-2">
                  <label class="block text-xs font-bold text-gray-400 mb-2"
                    >Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ù†Ø±</label
                  ><input
                    v-model="settings.heroImage"
                    class="input-std text-left ltr" />
                </div>
                <div>
                  <label class="block text-xs font-bold text-gray-400 mb-2"
                    >Ø§Ù„Ø¹Ù†ÙˆØ§Ù† 1</label
                  ><input v-model="settings.heroTitle1" class="input-std" />
                </div>
                <div>
                  <label class="block text-xs font-bold text-gray-400 mb-2"
                    >Ø§Ù„Ø¹Ù†ÙˆØ§Ù† 2</label
                  ><input v-model="settings.heroTitle2" class="input-std" />
                </div>
              </div>
              <div class="flex justify-end">
                <button @click="saveSettings" class="btn-primary px-10">
                  Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                </button>
              </div>
            </div>
          </div>
        </div>
      </main>

      <div
        v-if="showAddProductModal"
        class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center backdrop-blur-sm p-4">
        <div
          class="bg-dark-800 border border-dark-700 w-full max-w-xl rounded-2xl shadow-2xl p-8 relative text-white">
          <button
            @click="showAddProductModal = false; editingProduct = null; newProduct = {}"
            class="absolute top-4 left-4 text-gray-400 hover:text-white">
            <i class="fa-solid fa-times text-xl"></i>
          </button>

          <h3 class="text-2xl font-bold mb-6">
            {{ editingProduct ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬: ' + editingProduct.name : 'Ø¥Ø¶Ø§ÙØ©
            Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯' }}
          </h3>

          <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="col-span-2">
              <input
                :value="editingProduct ? editingProduct.name : newProduct.name"
                @input="editingProduct ? editingProduct.name = $event.target.value : newProduct.name = $event.target.value"
                class="input-std"
                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" />
            </div>

            <div>
              <input
                :value="editingProduct ? editingProduct.price : newProduct.price"
                @input="editingProduct ? editingProduct.price = $event.target.value : newProduct.price = $event.target.value"
                type="number"
                class="input-std"
                placeholder="Ø§Ù„Ø³Ø¹Ø±" />
            </div>

            <div>
              <input
                :value="editingProduct ? editingProduct.oldPrice : newProduct.oldPrice"
                @input="editingProduct ? editingProduct.oldPrice = $event.target.value : newProduct.oldPrice = $event.target.value"
                type="number"
                class="input-std"
                placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…" />
            </div>

            <div class="col-span-2">
              <input
                :value="editingProduct ? editingProduct.image : newProduct.image"
                @input="editingProduct ? editingProduct.image = $event.target.value : newProduct.image = $event.target.value"
                class="input-std"
                placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" />
            </div>
          </div>

          <button @click="addProduct" class="btn-primary w-full">
            {{ editingProduct ? 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' : 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬' }}
          </button>
        </div>
      </div>
    </div>

    <script>
      // âš ï¸ Firebase Config âš ï¸
      const firebaseConfig = {
        apiKey: "AIzaSyAUxHWPtXVUOsmvMWxSN4wyCmGTpSzVFik",
        authDomain: "nova-b91d4.firebaseapp.com",
        databaseURL: "https://nova-b91d4-default-rtdb.firebaseio.com",
        projectId: "nova-b91d4",
        storageBucket: "nova-b91d4.firebasestorage.app",
        messagingSenderId: "993960824562",
        appId: "1:993960824562:web:a23cc53cab7adbe2c44a6b",
        measurementId: "G-BFQXQ3442Z",
      };

      if (typeof firebase !== "undefined" && typeof Vue !== "undefined") {
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        const { createApp, ref, onMounted, computed, watch } = Vue;

        createApp({
          setup() {
            const currentUser = ref(null);
            const loading = ref(true);
            const authForm = ref({ email: "", password: "" });
            const errorMsg = ref("");

            const urlParams = new URLSearchParams(window.location.search);
            const initialVendorId = urlParams.get("vendorId");

            const currentUserRole = ref(null);
            const allVendors = ref({});
            const activeVendorId = ref(null);
            const currentUserVendors = ref([]);

            const currentView = ref("dashboard");
            const menus = ref({ orders: false, products: false, store: false });
            const showAddProductModal = ref(false);

            const settings = ref({});
            const products = ref({});
            const orders = ref({});
            const newProduct = ref({});
            const editingProduct = ref(null);

            const isPlatformAdmin = computed(
              () => currentUserRole.value === "platform_admin"
            );
            const dbPath = computed(() =>
              activeVendorId.value ? `vendors/${activeVendorId.value}` : null
            );
            const viewTitle = computed(() => {
              switch (currentView.value) {
                case "dashboard":
                  return "Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©";
                case "products_manage":
                  return "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª";
                case "orders_manage":
                  return "Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª";
                case "store_settings":
                  return "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±";
                default:
                  return "Nova Admin";
              }
            });
            const totalRevenue = computed(() =>
              Object.values(orders.value)
                .reduce((sum, order) => sum + (order.total || 0), 0)
                .toFixed(2)
            );
            const pendingCount = computed(
              () =>
                Object.values(orders.value).filter(
                  (order) => order.status === "pending"
                ).length
            );

            const fetchPlatformData = () => {
              db.ref("vendors")
                .once("value")
                .then((snapshot) => {
                  if (snapshot.exists()) {
                    allVendors.value = snapshot.val();
                  }
                });
            };

            const setActiveVendor = (vendorId) => {
              activeVendorId.value = vendorId;
              navigateTo("dashboard");
            };

            watch(
              dbPath,
              (newPath) => {
                if (newPath) {
                  db.ref(`${newPath}/store_info`).off();
                  db.ref(`${newPath}/products`).off();
                  db.ref(`${newPath}/orders`).off();

                  db.ref(`${newPath}/store_info`).on("value", (s) => {
                    if (s.exists()) settings.value = s.val();
                  });
                  db.ref(`${newPath}/products`).on("value", (s) => {
                    if (s.exists()) products.value = s.val();
                  });
                  db.ref(`${newPath}/orders`).on("value", (s) => {
                    if (s.exists()) {
                      orders.value = s.val();
                    }
                  });
                } else {
                  settings.value = {};
                  products.value = {};
                  orders.value = {};
                }
              },
              { immediate: false }
            );

            const determineUserRole = async (user) => {
              const emailKey = user.email.replace(/\./g, ",");

              const adminSnapshot = await db
                .ref(`platform_admins/${emailKey}`)
                .once("value");
              if (adminSnapshot.exists()) {
                currentUserRole.value = "platform_admin";
                fetchPlatformData();
                return;
              }

              const vendorsSnapshot = await db.ref("vendors").once("value");
              const userVendorIds = [];
              let firstVendorId = null;

              vendorsSnapshot.forEach((vendor) => {
                const vendorId = vendor.key;
                const users = vendor.val().users;

                if (users && users[emailKey]) {
                  userVendorIds.push(vendorId);
                  if (!firstVendorId) {
                    firstVendorId = vendorId;
                  }
                }
              });

              if (userVendorIds.length > 0) {
                currentUserRole.value = "vendor_user";

                currentUserVendors.value = userVendorIds;
                fetchPlatformData();

                let preferredVendorId = firstVendorId;
                if (
                  initialVendorId &&
                  userVendorIds.includes(initialVendorId)
                ) {
                  preferredVendorId = initialVendorId;
                }

                setActiveVendor(preferredVendorId);
                return;
              }

              auth.signOut();
              errorMsg.value = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø£ÙŠ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ….";
            };

            const login = async () => {
              loading.value = true;
              errorMsg.value = "";
              try {
                const userCredential = await auth.signInWithEmailAndPassword(
                  authForm.value.email,
                  authForm.value.password
                );
                determineUserRole(userCredential.user);
              } catch (e) {
                errorMsg.value = "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©!";
                loading.value = false;
              }
            };

            const logout = () => {
              auth.signOut();
            };

            const navigateTo = (view) => {
              currentView.value = view;
            };
            const toggleMenu = (name) => {
              menus.value[name] = !menus.value[name];
            };
            const isMenuOpen = (name) => menus.value[name];

            const saveSettings = () => {
              if (dbPath.value) {
                db.ref(`${dbPath.value}/store_info`)
                  .set(settings.value)
                  .then(() => {
                    alert("ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ù†Ø¬Ø§Ø­.");
                  })
                  .catch((e) => {
                    alert("ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: " + e.message);
                  });
              }
            };

            const editProduct = (key, product) => {
              editingProduct.value = {
                ...product,
                key: key,
                price: parseFloat(product.price || 0),
                oldPrice: parseFloat(product.oldPrice || 0),
              };
              showAddProductModal.value = true;
            };

            const saveEditedProduct = () => {
              if (
                !dbPath.value ||
                !editingProduct.value.name ||
                !editingProduct.value.key
              )
                return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬.");

              const { key, ...dataToSave } = editingProduct.value;

              db.ref(`${dbPath.value}/products/${key}`)
                .set(dataToSave)
                .then(() => {
                  alert("ØªÙ… Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­.");
                  showAddProductModal.value = false;
                  editingProduct.value = null;
                })
                .catch((e) => {
                  alert("ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: " + e.message);
                });
            };

            const addProduct = () => {
              if (editingProduct.value) {
                saveEditedProduct();
              } else {
                if (!dbPath.value || !newProduct.value.name)
                  return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬.");
                db.ref(`${dbPath.value}/products`)
                  .push(newProduct.value)
                  .then(() => {
                    alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­.");
                    newProduct.value = {};
                    showAddProductModal.value = false;
                  });
              }
            };

            const deleteProduct = (key) => {
              if (dbPath.value && confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) {
                db.ref(`${dbPath.value}/products/${key}`)
                  .remove()
                  .then(() => {
                    alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬.");
                  });
              }
            };

            onMounted(() => {
              auth.onAuthStateChanged((user) => {
                currentUser.value = user;
                loading.value = false;
                if (user) determineUserRole(user);
              });
            });

            return {
              currentUser,
              authForm,
              login,
              logout,
              loading,
              errorMsg,
              currentUserRole,
              isPlatformAdmin, // ğŸ¯ ØªÙ… ØªØ¶Ù…ÙŠÙ†Ù‡
              activeVendorId,
              allVendors,
              currentUserVendors,
              setActiveVendor,
              dbPath,
              currentView,
              menus,
              showAddProductModal,
              settings,
              products,
              orders,
              newProduct,
              editingProduct,
              totalRevenue,
              pendingCount,
              navigateTo,
              toggleMenu,
              isMenuOpen,
              editProduct,
              saveEditedProduct,
              addProduct,
              deleteProduct,
              saveSettings,
              viewTitle,
            };
          },
        }).mount("#app");
      } else {
        document.body.innerHTML = `
            <div style="background: #1e293b; color: white; padding: 20px; text-align: center; margin-top: 50px; border-radius: 10px;">
                <h1>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„! ğŸš¨</h1>
                <p>ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Vue Ø£Ùˆ Firebase). ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.</p>
            </div>
        `;
      }
    </script>
  </body>
</html>
