<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ settings.logoName || 'Nova Store' }}</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'Cairo', 'sans-serif'] },
                    colors: { brand: { 500: '#3b82f6', 600: '#2563eb' } }
                }
            }
        }
    </script>
    <style>
        body { @apply bg-gray-50 text-gray-800 font-sans antialiased; }
        .product-card { @apply bg-white p-6 rounded-xl shadow-lg border border-gray-100 transition-all hover:shadow-xl hover:-translate-y-1; }
        [v-cloak] { display: none; }
    </style>
</head>
<body>

    <div id="app" v-cloak>
        
        <header class="sticky top-0 z-40 bg-white border-b border-gray-100 shadow-sm">
            <div class="container mx-auto px-6 h-16 flex justify-between items-center">
                <a href="#" class="text-2xl font-black tracking-tighter text-black">
                    {{ settings.logoName || 'متجر Nova' }}<span class="text-brand-500">.</span>
                </a>
                <div class="flex items-center space-x-5 text-gray-700 space-x-reverse">
                    <button class="text-sm font-bold border border-gray-300 px-3 py-1 rounded hover:bg-black hover:text-white transition">
                        <i class="fa-solid fa-cart-shopping ml-1"></i> 
                        السلة (0)
                    </button>
                </div>
            </div>
        </header>

        <section class="relative h-[300px] flex items-center justify-center text-center overflow-hidden" 
                 :style="{ backgroundImage: `url(${settings.heroImage})`, backgroundSize: 'cover', backgroundPosition: 'center' }">
            <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
            <div class="z-10 text-white">
                <h1 class="text-5xl font-black mb-2">{{ settings.heroTitle1 || 'أفضل العروض' }}</h1>
                <p class="text-xl font-medium">{{ settings.heroTitle2 || 'تسوق الآن!' }}</p>
            </div>
        </section>

        <section id="products" class="py-20 container mx-auto px-6">
            <h2 class="text-3xl font-black text-center mb-10">جميع المنتجات</h2>

            <div v-if="loading" class="text-center py-20 text-gray-400">
                <i class="fa-solid fa-circle-notch fa-spin text-4xl"></i>
                <p class="mt-4">جارٍ تحميل المتجر...</p>
            </div>

            <div v-else-if="Object.keys(products).length === 0" class="text-center py-20 text-gray-500">
                <p class="text-xl font-bold">عذراً، لا توجد منتجات حالياً في هذا المتجر.</p>
                <p class="text-sm mt-2">يرجى من البائع إضافة المنتجات من لوحة التحكم.</p>
            </div>
            
            <div v-else class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <div v-for="(product, key) in products" :key="key" class="product-card group relative">
                    <div class="h-40 mb-4 flex items-center justify-center bg-gray-50 rounded-lg overflow-hidden">
                         <img :src="product.image || 'https://via.placeholder.com/150'" class="max-h-full object-contain mix-blend-multiply transition duration-500 group-hover:scale-105">
                    </div>
                    
                    <h3 class="font-bold text-lg text-gray-900 mb-1">{{ product.name }}</h3>
                    
                    <div class="flex items-center space-x-2 space-x-reverse">
                        <span class="font-black text-xl text-brand-500">{{ product.price }} EGP</span>
                        <span v-if="product.oldPrice" class="text-sm text-gray-400 line-through">{{ product.oldPrice }} EGP</span>
                    </div>

                    <button class="w-full mt-4 bg-black text-white py-2 rounded-lg font-bold hover:bg-brand-600 transition">
                        أضف للسلة
                    </button>
                </div>
            </div>
        </section>

        <footer class="bg-gray-900 text-white py-10 mt-12">
            <div class="container mx-auto px-6 text-center text-sm">
                <p>&copy; 2025 {{ settings.logoName || 'Nova Store' }}. جميع الحقوق محفوظة.</p>
            </div>
        </footer>

    </div>

    <script>
        // ⚠️ Firebase Config ⚠️
        const firebaseConfig = {
            apiKey: "AIzaSyAUxHWPtXVUOsmvMWxSN4wyCmGTpSzVFik",
            authDomain: "nova-b91d4.firebaseapp.com",
            databaseURL: "https://nova-b91d4-default-rtdb.firebaseio.com",
            projectId: "nova-b91d4",
            appId: "1:993960824562:web:a23cc53cab7adbe2c44a6b",
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const { createApp, ref, onMounted, computed } = Vue;
        
        // =========================================================
        // 1. دالة قراءة الـ Vendor ID من الرابط (URL)
        // =========================================================
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const VENDOR_ID = getQueryParam('vendorId');
        const DB_PATH = VENDOR_ID ? `vendors/${VENDOR_ID}` : null;
        // =========================================================


        createApp({
            setup() {
                const settings = ref({});
                const products = ref({});
                const loading = ref(true);

                onMounted(() => {
                    if (!DB_PATH) {
                        console.error("Vendor ID is missing in the URL. Cannot load store data.");
                        loading.value = false;
                        settings.value.logoName = "خطأ: متجر غير محدد";
                        return;
                    }
                    
                    // جلب إعدادات المتجر (الاسم، البانر)
                    db.ref(`${DB_PATH}/store_info`).on('value', s => { 
                        if(s.exists()) settings.value = s.val(); 
                    });
                    
                    // جلب المنتجات
                    db.ref(`${DB_PATH}/products`).on('value', s => { 
                        if(s.exists()) products.value = s.val(); 
                        loading.value = false;
                    });
                });

                return { settings, products, loading };
            }
        }).mount('#app');
    </script>
</body>
</html>     
